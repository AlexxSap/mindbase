
deadline указывает на момент времени, определяемый одним из следующих способов:

• `time.Duration` с настоящего момента (например, через 250 мс); 
• `time.Time `(например, 2023-02-07 00:00:00 UTC).

Семантика deadline означает, что текущая деятельность должна быть остановлена, если этот крайний срок наступил. «Деятельность» — это, например, запрос типа ввод/вывод или горутина в состоянии ожидания получения сообщения из канала.

Рассмотрим пример, который каждые 4 секунды получает от радара данные о позиции самолета. Получив позицию, мы хотим поделиться ею с другими приложениями, для которых интерес представляет только последняя позиция.

В нашем распоряжении есть интерфейс `publisher`, содержащий в себе один единственный метод:

```go
type publisher interface {
   Publish(ctx context.Context, position flight.Position) error
}
```


Этот метод принимает контекст и позицию. Предполагается, что конкретная реализация вызывает функцию для публикации сообщения брокеру (например, использование Sarama для публикации сообщения Kafka). 

Эта функция контекстно-зависимая, это означает, что она может отменить запрос после отмены контекста. Предполагая, что мы не получаем существующий контекст, что нужно предоставить методу Publish в качестве аргумента контекста? 

Создаваемый контекст должен сообщать о ней через 4 секунды, а если мы не смогли опубликовать позицию, то следует остановить вызов Publish:

```go
type publishHandler struct {
    pub publisher
}
func (h publishHandler) publishPosition(position flight.Position) error { 
    ctx, cancel := context.WithTimeout(context.Background(), 4*time.Second) 
    defer cancel() 
    return h.pub.Publish(ctx, position)
}
```

Код создает контекст с помощью функции `context.WithTimeout`, которая принимает тайм-аут и контекст. Поскольку `publishPosition` не получает существующий контекст, мы создаем его из пустого контекста с помощью `context.Background`. Между тем `context.WithTimeout` возвращает две переменные: созданный контекст и функцию отмены `func()`, которая отменит контекст после вызова. Передача созданного контекста в метод `Publish` должна произойти не позднее чем через 4 секунды.

В чем смысл вызова функции `cancel` как функции `defer`? `WithTimeout` создает горутину, которая будет храниться в памяти в течение 4 секунд или до тех пор, пока не будет вызвана `cancel`. Следовательно, вызов `cancel` в качестве функции `defer` означает, что при выходе из родительской функции контекст будет отменен, а созданная горутина остановлена. Это мера предосторожности, чтобы при возвращении мы не оставили в памяти сохраненные объекты.