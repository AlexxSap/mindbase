## Что такое «goroutine leak», как его можно предотвратить и как диагностировать такие утечки?

`goroutine leak` — это ситуация, когда горутина продолжает работать, несмотря на то, что её задача завершена или больше не актуальна, что приводит к утечке памяти и ресурсов. Это может произойти, если горутина ждет на канале, блокируется или не завершает свою работу должным образом.

Причины утечек горутин:
1. Горутину, которая ждет данных из канала, нельзя завершить, если канал не закрыт.
2. Если горутина застревает в select или for без выхода, например, в ожидании данных из канала, который больше не отправляет значения.
3. Если горутина не проверяет context.Done() для завершения, она может продолжать работать, даже если операция больше не нужна.

Как предотвратить:
1. Использование контекста (context) для отмены длительных операций. Важно проверять context.Done() для своевременного завершения работы горутины.
2. Закрытие каналов, когда больше не требуется передавать данные, чтобы все горутины, ожидающие на этом канале, могли завершиться.
3. Обработка ошибок и гарантии выхода из блокирующих операций в случае ошибок или таймаутов.

Как диагностировать:
1. Профилирование с помощью pprof: инструмент позволяет отслеживать активные горутины и выявлять утечки.
2. Тестирование на гонки: использование команды go test -race помогает обнаружить ошибки синхронизации, которые могут привести к утечкам.
3. Мониторинг горутин: с помощью логирования или специфичных инструментов (например, Go-Routine Inspector) можно отслеживать, какие горутины остаются активными.
